<!DOCTYPE html>
<!-- saved from url=(0031)https://primexbt.com/xd-storage -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>XdStorage</title>
  </head>
  <body>
    <script>
      (function (window) {
        if (!window.parent) {
          return;
        }

        function setCookie(name, value, options) {
          options = options || {};

          var expires = options.expires;

          if (typeof expires == 'number' && expires) {
            var d = new Date();
            d.setTime(d.getTime() + expires * 1000);
            expires = options.expires = d;
          }
          if (expires && expires.toUTCString) {
            options.expires = expires.toUTCString();
          }

          value = encodeURIComponent(value);

          var updatedCookie = name + '=' + value;

          for (var propName in options) {
            updatedCookie += '; ' + propName;
            var propValue = options[propName];
            if (propValue !== true) {
              updatedCookie += '=' + propValue;
            }
          }

          document.cookie = updatedCookie;
        }

        function getCookie(name) {
          var matches = document.cookie.match(
            new RegExp(
              '(?:^|; )' + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)',
            ),
          );
          return matches ? decodeURIComponent(matches[1]) : undefined;
        }

        function deleteCookie(name) {
          setCookie(name, '', {
            samesite: 'none',
            secure: true,
            expires: -1,
          });
        }

        /**
         * @type {Array<{ origin: string, access: 'r' | 'rw' }>}
         */
        // var allowedOrigins = [
        //   {access: 'r', origin: 'http://localhost:5000'},
        //   {access: 'rw', origin: 'http://localhost:3000'}
        // ];

        function handleStorageGet(msg) {
          // if (allowedOrigins.map(function (ao) { return ao.origin }).indexOf(origin) === -1) {
          //   console.warn('store access denied for ' + origin + ' origin');
          //   return;
          // }

          window.parent.postMessage(
            {
              action: 'storage.get-return',
              rid: msg.data.rid,
              key: msg.data.key,
              val: getCookie(msg.data.key),
            },
            msg.origin,
          );
        }

        function handleStorageSet(msg) {
          // if (allowedOrigins.filter(function (ao) {
          //   return ao.access === 'rw'
          // }).map(function (ao) {
          //   return ao.origin
          // }).indexOf(origin) === -1) {
          //   console.warn('store access denied for ' + origin + ' origin');
          //   return;
          // }

          setCookie(
            msg.data.key,
            msg.data.val,
            Object.assign(
              {
                samesite: 'none',
                secure: true,
              },
              msg.data.options || {},
            ),
          );

          window.parent.postMessage(
            {
              action: 'storage.set-return',
              rid: msg.data.rid,
              key: msg.data.key,
              val: true,
            },
            msg.origin,
          );
        }

        function handleStorageDelete(msg) {
          // if (allowedOrigins.filter(function (ao) {
          //   return ao.access === 'rw'
          // }).map(function (ao) {
          //   return ao.origin
          // }).indexOf(origin) === -1) {
          //   console.warn('store access denied for ' + origin + ' origin');
          //   return;
          // }

          deleteCookie(msg.data.key);
          msg.source.postMessage(
            {
              action: 'storage.remove-return',
              rid: msg.data.rid,
              key: msg.data.key,
              val: true,
            },
            msg.origin,
          );
        }

        window.addEventListener('message', function (msg) {
          switch (msg.data.action) {
            case 'storage.get':
              handleStorageGet(msg);
              break;
            case 'storage.set':
              handleStorageSet(msg);
              break;
            case 'storage.remove':
              handleStorageDelete(msg);
              break;
          }
        });

        window.parent.postMessage({ action: 'storage.ready' }, '*');
      })(window);
    </script>
  

</body></html>